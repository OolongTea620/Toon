<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
   <mapper namespace="com.to.t1.member.MemberMapper">
   
		<insert id="setJoin" parameterType="MemberVO">
			insert into member (username, password, name, nickname, phone, email)
			values(#{username}, #{password}, #{name}, #{nickname}, #{phone}, #{email})
		</insert>  
		
		<insert id="setJoinFile" parameterType="JoinFileVO">
			insert into joinfiles (username, fileName, oriName) values(#{username}, #{fileName}, #{oriName})
		</insert>

		<select id="getUsername" parameterType="MemberVO" resultType="MemberVO">
			select * from member where username=#{username}
		</select>
		
		<select id="searchId"  parameterType="MemberVO" resultType="MemberVO">
			select username from member where name=#{name} and phone=#{phone}
		</select>
		
		<select id="searchPw"  parameterType="MemberVO" resultType="MemberVO">
			select password from member where username=#{username} and phone=#{phone}
		</select>
		
		<select id="getLogin" parameterType="MemberVO" resultMap="memberLoginResult">
			select M.*, MF.fileName 
			from member M left join joinfiles MF
			on M.username = MF.username
			where
			M.username=#{username} and M.password=#{password}
		</select>

		<update id="memberUpdate" parameterType="MemberVO">
			update member set password=#{password}, name=#{name}, nickname=#{nickname}, phone=#{phone}, email=#{email} where username=#{username}
		</update>

		<update id="pwUpdate" parameterType="MemberVO">
			update member set PASSWORD=#{password} where username=#{username}
		</update>
		
		<delete id="memberDelete" parameterType="MemberVO">
			delete from member where username=#{username}
		</delete>
		
		<select id="getJoinFile" parameterType="MemberVO" resultType="JoinFileVO">
			select fileName from joinfiles where username=#{username}
		</select>
		
		<resultMap type="MemberVO" id="memberLoginResult">
		<id property="username" column="username" />
		<result property="password" column="password"/>
		<result property="name" column="name"/>
		<result property="nickname" column="name"/>
		<result property="phone" column="phone"/>
		<result property="email" column="email"/>
		<result property="point" column="point"/>
		<association property="joinFileVO" javaType="JoinFileVO" resultMap="memberFileResult">
		
		</association>
	</resultMap>
	
	<resultMap type="JoinFileVO" id="memberFileResult">
			<id property="fileNum" column="fileNum"/>
			<result property="fileName" column="fileName"/>
			<result property="oriName" column="oriName"/>
	</resultMap>
		
			
   </mapper>